@model ItemDataResponseModel
@{
    ViewData["Title"] = "Home Page";
}

<div class="cartTab">
    <h1>Shopping Cart</h1>
    <div class="listCart">
        <!-- Cart items will be dynamically added here -->
    </div>
    <div class="btn">
        <button class="close">CLOSE</button>
        <button class="checkOut">Check Out</button>
    </div>
</div>
<div class="container">
    @foreach (var item in Model.Data)
    {
        <div class="listProduct">
            <div data-id="@item.ItemId" class="item">
                <img src="~/assets/image/@(item.ItemId).png" />
                <h2>@item.Name</h2>
                <div>
                    Price:
                    <span class="price"> $@item.Price</span>
                </div>
                <div class="cartControls">
                    <div>Item Count :<span class="itemCount" id="count_@item.ItemId">1</span> </div>
                    <button class="reduceCount" onclick="reduceCount('@item.ItemId')">-</button>
                    <button class="increaseCount" onclick="increaseCount('@item.ItemId', '@item.Name', @item.Price)">+</button>
                    <button class="addToCart" onclick="addToCart('@item.ItemId', '@item.Name', @item.Price)">Add To Cart</button>
                </div>
            </div>
        </div>
    }
</div>

@section scripts {
    <script>
        function addToCart(itemId, itemName, itemPrice) {

            var countElement = document.getElementById('count_' + itemId);
            var count = parseInt(countElement.innerHTML);

            var existingCartItem = document.querySelector('.cartItem[data-id="' + itemId + '"]');

            if (existingCartItem) {

                var existingCount = parseInt(existingCartItem.querySelector('.itemCountInCart').textContent.split(':')[1].trim());
                existingCount += count;
                existingCartItem.querySelector('.itemCountInCart').textContent = 'Quantity: ' + existingCount;

                var totalPrice = itemPrice * existingCount;
                existingCartItem.querySelector('.itemPrice').textContent = '$' + totalPrice;
            } else {
                var cartItem = document.createElement('div');
                cartItem.classList.add('cartItem');
                cartItem.setAttribute('data-id', itemId);
                cartItem.innerHTML = `
                    <div class="cartItemInfo">
                        <span class="itemName">${itemName}</span>
                        <span class="itemPrice">$${itemPrice * count}</span>
                        <span class="itemCountInCart">Quantity: ${count}</span>
                    </div>
                    <button class="removeFromCart" onclick="removeFromCart(this)">Remove</button>
                `;

                document.querySelector('.listCart').appendChild(cartItem);
            }
        }

        function increaseCount(itemId, itemName, itemPrice) {
            var countElement = document.getElementById('count_' + itemId);
            var count = parseInt(countElement.innerHTML);
            count++;
            countElement.innerHTML = count;

            addToCart(itemId, itemName, itemPrice);
        }

        function reduceCount(itemId) {
            var countElement = document.getElementById('count_' + itemId);
            var count = parseInt(countElement.innerHTML);
            count = Math.max(0, count - 1);
            countElement.innerHTML = count;

            addToCart(itemId);
        }

        function removeFromCart(button) {
            button.parentNode.parentNode.removeChild(button.parentNode);
        }
    </script>
}
